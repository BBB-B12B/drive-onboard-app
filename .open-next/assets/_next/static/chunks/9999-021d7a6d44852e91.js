"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9999],{243:(e,t,a)=>{a.d(t,{E:()=>l});var r=a(5155),s=a(4269);function l(e){let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,s.cn)("animate-pulse rounded-md bg-muted",t),...a})}},276:(e,t,a)=>{a.d(t,{V:()=>n});var r=a(5155);a(2115);var s=a(1190),l=a(3263),i=a(9987),o=a(4269),d=a(3998);function n(e){let{className:t,classNames:a,showOutsideDays:n=!0,...c}=e;return(0,r.jsx)(i.hv,{showOutsideDays:n,className:(0,o.cn)("p-3",t),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,o.cn)((0,d.r)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,o.cn)((0,d.r)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...a},components:{IconLeft:e=>{let{...t}=e;return(0,r.jsx)(s.A,{className:"h-4 w-4"})},IconRight:e=>{let{...t}=e;return(0,r.jsx)(l.A,{className:"h-4 w-4"})}},...c})}n.displayName="Calendar"},1186:(e,t,a)=>{a.d(t,{bq:()=>p,eb:()=>x,gC:()=>h,l6:()=>c,yv:()=>u});var r=a(5155),s=a(2115),l=a(4729),i=a(9007),o=a(2614),d=a(2251),n=a(4269);let c=l.bL;l.YJ;let u=l.WT,p=s.forwardRef((e,t)=>{let{className:a,children:s,...o}=e;return(0,r.jsxs)(l.l9,{ref:t,className:(0,n.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),...o,children:[s,(0,r.jsx)(l.In,{asChild:!0,children:(0,r.jsx)(i.A,{className:"h-4 w-4 opacity-50"})})]})});p.displayName=l.l9.displayName;let m=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(l.PP,{ref:t,className:(0,n.cn)("flex cursor-default items-center justify-center py-1",a),...s,children:(0,r.jsx)(o.A,{className:"h-4 w-4"})})});m.displayName=l.PP.displayName;let f=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(l.wn,{ref:t,className:(0,n.cn)("flex cursor-default items-center justify-center py-1",a),...s,children:(0,r.jsx)(i.A,{className:"h-4 w-4"})})});f.displayName=l.wn.displayName;let h=s.forwardRef((e,t)=>{let{className:a,children:s,position:i="popper",...o}=e;return(0,r.jsx)(l.ZL,{children:(0,r.jsxs)(l.UC,{ref:t,className:(0,n.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===i&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:i,...o,children:[(0,r.jsx)(m,{}),(0,r.jsx)(l.LM,{className:(0,n.cn)("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),(0,r.jsx)(f,{})]})})});h.displayName=l.UC.displayName,s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(l.JU,{ref:t,className:(0,n.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...s})}).displayName=l.JU.displayName;let x=s.forwardRef((e,t)=>{let{className:a,children:s,...i}=e;return(0,r.jsxs)(l.q7,{ref:t,className:(0,n.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...i,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(l.VF,{children:(0,r.jsx)(d.A,{className:"h-4 w-4"})})}),(0,r.jsx)(l.p4,{children:s})]})});x.displayName=l.q7.displayName,s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(l.wv,{ref:t,className:(0,n.cn)("-mx-1 my-1 h-px bg-muted",a),...s})}).displayName=l.wv.displayName},1289:(e,t,a)=>{a.d(t,{A:()=>l});var r=a(4227),s=a(2115);let l=()=>{let e=(0,s.useContext)(r.c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},3998:(e,t,a)=>{a.d(t,{$:()=>n,r:()=>d});var r=a(5155),s=a(2115),l=a(2467),i=a(3101),o=a(4269);let d=(0,i.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",success:"bg-success text-success-foreground hover:bg-success/90"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),n=s.forwardRef((e,t)=>{let{className:a,variant:s,size:i,asChild:n=!1,...c}=e,u=n?l.DX:"button";return(0,r.jsx)(u,{className:(0,o.cn)(d({variant:s,size:i,className:a})),ref:t,...c})});n.displayName="Button"},4227:(e,t,a)=>{a.d(t,{AuthProvider:()=>o,c:()=>i});var r=a(5155),s=a(2115),l=a(6489);let i=(0,s.createContext)(void 0);function o(e){let{children:t}=e,{data:a,status:s}=(0,l.useSession)(),o="loading"===s,d=null==a?void 0:a.user;return o?(0,r.jsx)("div",{className:"flex items-center justify-center h-screen w-full",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-primary"})}):(0,r.jsx)(i.Provider,{value:{user:d,login:()=>{(0,l.signIn)()},logout:()=>{(0,l.signOut)({callbackUrl:"/login"})},loading:o},children:t})}},4269:(e,t,a)=>{a.d(t,{cn:()=>l});var r=a(2821),s=a(5889);function l(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,s.QP)((0,r.$)(t))}},5894:(e,t,a)=>{a.d(t,{dj:()=>u});var r=a(2115);let s=0,l=new Map,i=e=>{if(l.has(e))return;let t=setTimeout(()=>{l.delete(e),n({type:"REMOVE_TOAST",toastId:e})},1e6);l.set(e,t)},o=[],d={toasts:[]};function n(e){d=((e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:a}=t;return a?i(a):e.toasts.forEach(e=>{i(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}})(d,e),o.forEach(e=>{e(d)})}function c(e){let{...t}=e,a=(s=(s+1)%Number.MAX_SAFE_INTEGER).toString(),r=()=>n({type:"DISMISS_TOAST",toastId:a});return n({type:"ADD_TOAST",toast:{...t,id:a,open:!0,onOpenChange:e=>{e||r()}}}),{id:a,dismiss:r,update:e=>n({type:"UPDATE_TOAST",toast:{...e,id:a}})}}function u(){let[e,t]=r.useState(d);return r.useEffect(()=>(o.push(t),()=>{let e=o.indexOf(t);e>-1&&o.splice(e,1)}),[e]),{...e,toast:c,dismiss:e=>n({type:"DISMISS_TOAST",toastId:e})}}},6333:(e,t,a)=>{a.d(t,{AM:()=>o,Wv:()=>d,hl:()=>n});var r=a(5155),s=a(2115),l=a(1138),i=a(4269);let o=l.bL,d=l.l9,n=s.forwardRef((e,t)=>{let{className:a,align:s="center",sideOffset:o=4,...d}=e;return(0,r.jsx)(l.ZL,{children:(0,r.jsx)(l.UC,{ref:t,align:s,sideOffset:o,className:(0,i.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...d})})});n.displayName=l.UC.displayName},6444:(e,t,a)=>{a.d(t,{J:()=>n});var r=a(5155),s=a(2115),l=a(2894),i=a(3101),o=a(4269);let d=(0,i.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),n=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(l.b,{ref:t,className:(0,o.cn)(d(),a),...s})});n.displayName=l.b.displayName},6948:(e,t,a)=>{a.d(t,{BT:()=>n,Wu:()=>c,ZB:()=>d,Zp:()=>i,aR:()=>o,wL:()=>u});var r=a(5155),s=a(2115),l=a(4269);let i=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...s})});i.displayName="Card";let o=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",a),...s})});o.displayName="CardHeader";let d=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",a),...s})});d.displayName="CardTitle";let n=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",a),...s})});n.displayName="CardDescription";let c=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("p-6 pt-0",a),...s})});c.displayName="CardContent";let u=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("flex items-center p-6 pt-0",a),...s})});u.displayName="CardFooter"},8332:(e,t,a)=>{a.d(t,{Fc:()=>d,TN:()=>c,XL:()=>n});var r=a(5155),s=a(2115),l=a(3101),i=a(4269);let o=(0,l.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),d=s.forwardRef((e,t)=>{let{className:a,variant:s,...l}=e;return(0,r.jsx)("div",{ref:t,role:"alert",className:(0,i.cn)(o({variant:s}),a),...l})});d.displayName="Alert";let n=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("h5",{ref:t,className:(0,i.cn)("mb-1 font-medium leading-none tracking-tight",a),...s})});n.displayName="AlertTitle";let c=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,i.cn)("text-sm [&_p]:leading-relaxed",a),...s})});c.displayName="AlertDescription"},9999:(e,t,a)=>{a.d(t,{j:()=>I});var r=a(5155),s=a(2115),l=a(2687),i=a(7691),o=a(8109),d=a(8260),n=a(1289),c=a(6948),u=a(3998),p=a(2033),m=a(3630),f=a(7776),h=a(243);function x(e){let{slot:t,uploading:a,deleting:i,onUpload:o,onDelete:d,disabled:n,disabledReason:h}=e,x=(0,s.useRef)(null),v=a||i;return(0,r.jsxs)(c.Zp,{children:[(0,r.jsx)(c.aR,{children:(0,r.jsx)(c.ZB,{children:t.label})}),(0,r.jsxs)(c.Wu,{className:"space-y-4",children:[(0,r.jsx)("div",{className:"relative",children:t.url?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("img",{src:t.url,alt:t.label,className:"aspect-video w-full rounded-md object-cover"}),!n&&(0,r.jsx)(u.$,{variant:"destructive",size:"icon",className:"absolute top-2 right-2 h-8 w-8",onClick:d,disabled:v,"aria-label":"Delete image",children:i?(0,r.jsx)(p.A,{className:"h-4 w-4 animate-spin"}):(0,r.jsx)(m.A,{className:"h-4 w-4"})})]}):(0,r.jsx)("div",{className:"flex aspect-video w-full items-center justify-center rounded-md border-2 border-dashed border-muted-foreground/40",children:n?(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"ไม่มีข้อมูล"}):(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"No image uploaded"})})}),(0,r.jsxs)("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[(0,r.jsx)("span",{className:"truncate pr-2",children:t.fileName||"ยังไม่มีไฟล์"}),(0,r.jsx)("span",{children:t.uploadedAt?(0,l.GP)(new Date(t.uploadedAt),"PPp"):"-"})]}),(0,r.jsx)("input",{ref:x,type:"file",accept:"image/*",className:"hidden",onChange:e=>{var t;let a=null==(t=e.target.files)?void 0:t[0];a&&o(a)},disabled:v||n}),!n&&(0,r.jsxs)(u.$,{className:"w-full",onClick:()=>{var e;null==(e=x.current)||e.click()},disabled:v,children:[a?(0,r.jsx)(p.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,r.jsx)(f.A,{className:"mr-2 h-4 w-4"}),t.url?"Replace Image":"Upload Image"]}),n&&h&&!t.url&&(0,r.jsx)("p",{className:"text-xs text-center text-destructive",children:h})]})]})}x.Skeleton=function(){return(0,r.jsxs)(c.Zp,{children:[(0,r.jsxs)(c.aR,{children:[(0,r.jsx)(h.E,{className:"h-5 w-2/4"}),(0,r.jsx)(h.E,{className:"h-4 w-3/4"})]}),(0,r.jsxs)(c.Wu,{className:"space-y-4",children:[(0,r.jsx)(h.E,{className:"h-48 w-full"}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)(h.E,{className:"h-5 w-24"}),(0,r.jsx)(h.E,{className:"h-5 w-20"})]}),(0,r.jsx)(h.E,{className:"h-10 w-full"}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(h.E,{className:"h-4 w-1/4"}),(0,r.jsx)(h.E,{className:"h-4 w-3/4"})]})]})]})};var v=a(8734);let g=[{id:"check-in",label:"Check in ลงชื่อเข้างาน",group:"before"},{id:"pre-delivery",label:"ข้อมูลการจัดส่ง ก่อนเริ่มงาน",group:"before"},{id:"check-out",label:"Check Out ลงชื่อออกงาน",group:"after"},{id:"post-delivery",label:"ข้อมูลการจัดส่ง หลังจบงาน",group:"after"},{id:"suspension",label:'ข้อมูลการ "ระงับ"',group:"after"},{id:"payment-proof",label:"หลักฐานการโอนเงิน",group:"after"}];v.Yj().regex(/^\d{4}-\d{2}-\d{2}$/,{message:"รูปแบบวันที่ต้องเป็น YYYY-MM-DD"}),v.Yj().email(),g.map(e=>e.id);let y=g.length,b={"check-in":"https://images.unsplash.com/photo-1529429617124-aee3b6e0f156?auto=format&fit=crop&w=800&q=60","pre-delivery":"https://images.unsplash.com/photo-1502877338535-766e1452684a?auto=format&fit=crop&w=800&q=60","check-out":"https://images.unsplash.com/photo-1576013551627-0cc20b96c3c3?auto=format&fit=crop&w=800&q=60","post-delivery":"https://images.unsplash.com/photo-1549923746-c502d488b3ea?auto=format&fit=crop&w=800&q=60",suspension:"https://images.unsplash.com/photo-1503424886300-4ce5a5438e02?auto=format&fit=crop&w=800&q=60","payment-proof":"https://images.unsplash.com/photo-1523289333742-be1143f6b766?auto=format&fit=crop&w=800&q=60"},w=[{email:"driver.nattha@driveonboard.test",password:"Driver123!",name:"ณัฐพงษ์ ใจดี",role:"employee",avatarUrl:"https://i.pravatar.cc/150?img=47",phone:"081-345-6789",appId:"app-driver-001",dailyReportSlots:["check-in","pre-delivery","check-out"]},{email:"driver.saranya@driveonboard.test",password:"Driver123!",name:"สรัญญา สุขกาย",role:"employee",avatarUrl:"https://i.pravatar.cc/150?img=48",phone:"089-654-3210",appId:"app-driver-002",dailyReportSlots:["check-in","pre-delivery","check-out","post-delivery"],prefix:"นางสาว"},{email:"driver.chaiwat@driveonboard.test",password:"Driver123!",name:"ไชยวัฒน์ มั่นใจ",role:"employee",avatarUrl:"https://i.pravatar.cc/150?img=12",phone:"086-111-2233",appId:"app-driver-003",dailyReportSlots:["check-in","pre-delivery","check-out","post-delivery","suspension","payment-proof"],prefix:"นาย"}];[...w],w.map((e,t)=>{var a;return{appId:null!=(a=e.appId)?a:"sample-app-".concat(t+1),fullName:e.name,phone:e.phone,createdAt:new Date(2025,1,1+t).toISOString(),status:"approved"}}),w.reduce((e,t)=>{let[a,...r]=t.name.split(" "),s=r.join(" ")||"ไม่ทราบนามสกุล",l=new Date(2025,1,1).toISOString();if(t.appId){var i;e[t.appId]={appId:t.appId,createdAt:l,applicant:{prefix:null!=(i=t.prefix)?i:"นาย",firstName:a,lastName:s,fullName:t.name,mobilePhone:t.phone,email:t.email},applicationDetails:{position:"พนักงานขับรถ",applicationDate:new Date(l)},status:{completeness:"complete",verification:"approved"}}}return e},{});var j=a(6444),N=a(8332),S=a(8127),A=a(5866),E=a(5894),k=a(4269),D=a(1186),R=a(6333),C=a(276);let T=["image/jpeg","image/png","image/webp","image/heic"];function I(){var e,t;let{overrideDate:c,overrideEmail:m,className:f,onUpdate:h}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{user:v}=(0,n.A)(),I=(null==v?void 0:v.role)==="admin",{toast:_}=(0,E.dj)(),P=!!(c||m),[M,O]=(0,s.useState)(()=>null!=c?c:new Date),[U,L]=(0,s.useState)(null!=m?m:null),[z,F]=(0,s.useState)([]),[W,q]=(0,s.useState)(()=>null!=c?c:new Date),[G,J]=(0,s.useState)([]);(0,s.useEffect)(()=>{c&&(O(c),q(c))},[c]),(0,s.useEffect)(()=>{m&&L(m)},[m]);let[Z,V]=(0,s.useState)({}),[B,Y]=(0,s.useState)(!1),[$,K]=(0,s.useState)(null),[X,H]=(0,s.useState)({}),[Q,ee]=(0,s.useState)({}),[et,ea]=(0,s.useState)(!1),er=(0,s.useRef)(null);(0,s.useEffect)(()=>(er.current=new Worker(a.tu(new URL(a.p+a.u(9855),a.b))),()=>{var e;null==(e=er.current)||e.terminate()}),[]);let es=(0,s.useMemo)(()=>(0,l.GP)(M,"yyyy-MM-dd"),[M]),el=(0,s.useMemo)(()=>{if(I)return!1;let e=(0,i.o)(new Date),t=(0,i.o)(M);return 0!==(0,o.c)(e,t)},[M,I]),ei="".concat(null!=U?U:"",":").concat(es),eo=null!=(e=Z[ei])?e:null,ed=(0,s.useCallback)((e,t)=>{V(a=>{let r=Object.keys(a);if(r.includes(e))return{...a,[e]:t};let s={...a,[e]:t};if(r.length>=20){let e=r[0],{[e]:t,...a}=s;return a}return s})},[]);(0,s.useEffect)(()=>{!U&&(null==v?void 0:v.email)&&L(v.email)},[U,null==v?void 0:v.email]),(0,s.useEffect)(()=>{I&&(async()=>{try{let e=await fetch("/api/users",{cache:"no-store"});if(!e.ok)return;let t=await e.json();F(t),L(e=>{var a,r,s;return null!=(s=null!=(r=null!=e?e:null==v?void 0:v.email)?r:null==(a=t[0])?void 0:a.email)?s:null})}catch(e){console.error("Failed to load users",e)}})()},[I,null==v?void 0:v.email]),(0,s.useEffect)(()=>{U&&(async()=>{let e=new URLSearchParams({email:U,month:(0,l.GP)(W,"yyyy-MM")});try{let t=await fetch("/api/daily-reports/summary?".concat(e.toString()));if(t.ok){let e=await t.json().catch(()=>null),a=(Array.isArray(null==e?void 0:e.completedDates)?e.completedDates:Array.isArray(e)?e.filter(e=>{var t;return(null!=(t=null==e?void 0:e.uploadedCount)?t:0)>0}).map(e=>null==e?void 0:e.date).filter(Boolean):[]).map(e=>(0,d.qg)(e,"yyyy-MM-dd",new Date));J(a)}}catch(e){console.error("Failed to fetch report summary",e)}})()},[U,W]);let en=(0,s.useMemo)(()=>g.map(e=>({id:e.id,label:e.label,group:e.group})),[]),ec=null!=(t=null==eo?void 0:eo.slots)?t:en,eu=ec.filter(e=>"before"===e.group||e.id.startsWith("start")),ep=ec.filter(e=>"after"===e.group||e.id.startsWith("end")),em=(0,s.useCallback)(async()=>{if(U&&!Z[ei]){Y(!0),K(null),ea(!1);try{let e=new URLSearchParams({email:U,date:es}),t=await fetch("/api/daily-reports?".concat(e.toString()),{method:"GET",cache:"no-store"});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||"ไม่สามารถโหลดข้อมูลรายงานได้")}let a=await t.json();ed(ei,a)}catch(e){console.error("[DailyReport] load error",e),U?(ed(ei,function(e,t){var a;let r=w.find(t=>t.email.toLowerCase()===e.toLowerCase()),s=function(e,t){let a=new Date().toISOString();return{userEmail:e,date:t,createdAt:a,updatedAt:a,slots:g.reduce((e,t)=>(e[t.id]={id:t.id,label:t.label,group:t.group},e),{})}}(e,t);s.createdAt=new Date("".concat(t,"T08:00:00Z")).toISOString(),s.updatedAt=new Date("".concat(t,"T17:00:00Z")).toISOString();let l=new Set(null!=(a=null==r?void 0:r.dailyReportSlots)?a:[]),i=g.map((e,a)=>{let i=s.slots[e.id];if(l.has(e.id)){var o;i.r2Key="sample/".concat(null!=(o=null==r?void 0:r.appId)?o:"demo","/").concat(e.id,".jpg"),i.fileName="".concat(e.label,".jpg");let s=String(a+8).padStart(2,"0");i.uploadedAt=new Date("".concat(t,"T").concat(s,":15:00Z")).toISOString()}return{...i,url:l.has(e.id)?b[e.id]:void 0}});return{userEmail:s.userEmail,date:s.date,createdAt:s.createdAt,updatedAt:s.updatedAt,slots:i}}(U,es)),ea(!0),_({title:"แสดงข้อมูลตัวอย่าง",description:"ไม่สามารถเชื่อมต่อแหล่งข้อมูลจริงได้"})):V(e=>{let{[ei]:t,...a}=e;return a})}finally{Y(!1)}}},[es,U,_,ei,ed,Z]);(0,s.useEffect)(()=>{em()},[em]);let ef=(0,s.useCallback)(async(e,t)=>{if(U){if(et)return void _({variant:"destructive",title:"ไม่สามารถอัปโหลดไฟล์ได้",description:"โหมดทดลองใช้งาน"});if(!T.includes(t.type))return void _({variant:"destructive",title:"รูปแบบไฟล์ไม่ถูกต้อง",description:"รองรับเฉพาะ JPG, PNG, WEBP, HEIC"});if(t.size>5242880)return void _({variant:"destructive",title:"ไฟล์ใหญ่เกินไป",description:"ขนาดไฟล์ต้องไม่เกิน 5MB"});H(t=>({...t,[e]:!0}));try{var a;let{file:r,md5:s}=await new Promise((a,r)=>{if(!er.current)return void r(Error("Worker not initialized"));let s=t=>{if(t.data.id===e){var l;null==(l=er.current)||l.removeEventListener("message",s),"complete"===t.data.type?a({file:t.data.file,md5:t.data.md5}):r(Error(t.data.error||"Worker processing failed"))}};er.current.addEventListener("message",s),er.current.postMessage({type:"process",id:e,file:t})}),i=await fetch("/api/daily-reports/sign-put",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:U,date:es,slotId:e,fileName:r.name,mime:r.type,size:r.size,md5:s})});if(!i.ok)throw Error("ไม่สามารถสร้างลิงก์อัปโหลดได้");let{url:o,key:d}=await i.json();if(!(await fetch(o,{method:"PUT",body:r,headers:{"Content-Type":r.type,"Content-MD5":s}})).ok)throw Error("อัปโหลดไม่สำเร็จ");let n=await fetch("/api/daily-reports",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:U,date:es,slotId:e,r2Key:d,fileName:r.name})});if(!n.ok)throw Error("ไม่สามารถบันทึกข้อมูลได้");let c=await n.json();ed(ei,c),c.slots.filter(e=>e.r2Key).length>=y&&J(e=>e.find(e=>(0,l.GP)(e,"yyyy-MM-dd")===es)?e:[...e,M]),_({title:"บันทึกเรียบร้อย",description:"".concat((null==(a=ec.find(t=>t.id===e))?void 0:a.label)||"รายการ"," ถูกอัปเดตแล้ว")}),null==h||h()}catch(e){console.error("[DailyReport] upload error",e),_({variant:"destructive",title:"เกิดข้อผิดพลาด",description:e instanceof Error?e.message:"ไม่สามารถอัปโหลดได้"})}finally{H(t=>({...t,[e]:!1}))}}},[et,U,M,es,ec,_,ei,ed,h]),eh=(0,s.useCallback)(async e=>{if(U){if(et)return void _({variant:"destructive",title:"ไม่สามารถลบไฟล์ได้",description:"โหมดทดลองใช้งาน"});ee(t=>({...t,[e]:!0}));try{var t;let a=await fetch("/api/daily-reports",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:U,date:es,slotId:e})});if(!a.ok)throw Error("ไม่สามารถลบไฟล์ได้");let r=await a.json();ed(ei,r),r.slots.filter(e=>e.r2Key).length<y&&J(e=>e.filter(e=>(0,l.GP)(e,"yyyy-MM-dd")!==es)),_({title:"ลบรูปภาพเรียบร้อย",description:"".concat((null==(t=ec.find(t=>t.id===e))?void 0:t.label)||"รายการ"," ถูกลบแล้ว")}),null==h||h()}catch(e){console.error("[DailyReport] delete error",e),_({variant:"destructive",title:"เกิดข้อผิดพลาด",description:e instanceof Error?e.message:"ไม่สามารถลบได้"})}finally{ee(t=>({...t,[e]:!1}))}}},[et,U,es,ec,_,ei,ed,h]);return U?(0,r.jsxs)("div",{className:"mx-auto flex w-full max-w-6xl flex-col gap-6",children:[!P&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-semibold tracking-tight text-foreground",children:"Daily Report"}),(0,r.jsx)("p",{className:"mt-2 text-sm text-muted-foreground",children:"บันทึกข้อมูลพร้อมรูปภาพประกอบของการปฏิบัติงานแต่ละขั้นตอน สามารถอัปโหลดเพิ่มได้ตลอดวัน"})]}),!P&&(0,r.jsxs)("div",{className:"grid gap-4 rounded-lg border bg-card p-4 shadow-sm md:grid-cols-[1fr_auto] md:items-end",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(j.J,{htmlFor:"daily-report-date",children:"เลือกวันที่"}),(0,r.jsxs)(R.AM,{children:[(0,r.jsx)(R.Wv,{asChild:!0,children:(0,r.jsxs)(u.$,{variant:"outline",className:(0,k.cn)("w-full justify-start text-left font-normal",!M&&"text-muted-foreground"),children:[(0,r.jsx)(S.A,{className:"mr-2 h-4 w-4"}),M?(0,l.GP)(M,"PPP"):(0,r.jsx)("span",{children:"Pick a date"})]})}),(0,r.jsx)(R.hl,{className:"w-auto p-0",align:"start",children:(0,r.jsx)(C.V,{mode:"single",selected:M,onSelect:e=>e&&O(e),initialFocus:!0,modifiers:{completed:G},modifiersStyles:{completed:{color:"var(--primary)",fontWeight:"bold",textDecoration:"underline"}},onMonthChange:q})})]})]}),I&&(0,r.jsxs)("div",{className:"space-y-2 md:w-[300px]",children:[(0,r.jsx)(j.J,{htmlFor:"employee-select",children:"เลือกพนักงาน (Admin)"}),(0,r.jsxs)(D.l6,{value:U,onValueChange:L,children:[(0,r.jsx)(D.bq,{children:(0,r.jsx)(D.yv,{placeholder:"เลือกพนักงาน"})}),(0,r.jsx)(D.gC,{children:z.map(e=>(0,r.jsxs)(D.eb,{value:e.email,children:[e.name," (",e.email,")"]},e.email))})]})]}),(0,r.jsx)(u.$,{variant:"ghost",size:"icon",onClick:em,disabled:B,children:(0,r.jsx)(A.A,{className:(0,k.cn)("h-4 w-4",B&&"animate-spin")})})]}),$&&(0,r.jsxs)(N.Fc,{variant:"destructive",children:[(0,r.jsx)(N.XL,{children:"Error"}),(0,r.jsx)(N.TN,{children:$})]}),B&&!eo&&(0,r.jsx)("div",{className:"flex justify-center py-12",children:(0,r.jsx)(p.A,{className:"h-8 w-8 animate-spin text-muted-foreground"})}),!B&&(0,r.jsxs)("div",{className:"space-y-8",children:[(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold border-b pb-2",children:"ก่อนเริ่มงาน"}),(0,r.jsx)("div",{className:"grid gap-6 sm:grid-cols-2",children:eu.map(e=>(0,r.jsx)(x,{slot:e,uploading:X[e.id],deleting:Q[e.id],onUpload:t=>ef(e.id,t),onDelete:()=>eh(e.id),disabled:el,disabledReason:"ไม่สามารถแก้ไขย้อนหลังได้"},e.id))})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold border-b pb-2",children:"หลังเลิกงาน"}),(0,r.jsx)("div",{className:"grid gap-6 sm:grid-cols-2",children:ep.map(e=>(0,r.jsx)(x,{slot:e,uploading:X[e.id],deleting:Q[e.id],onUpload:t=>ef(e.id,t),onDelete:()=>eh(e.id),disabled:el,disabledReason:"ไม่สามารถแก้ไขย้อนหลังได้"},e.id))})]})]})]}):(0,r.jsxs)("div",{className:"mx-auto max-w-3xl py-12 text-center",children:[(0,r.jsx)("h1",{className:"text-2xl font-semibold",children:"จำเป็นต้องเข้าสู่ระบบ"}),(0,r.jsx)("p",{className:"mt-2 text-muted-foreground",children:"กรุณาเข้าสู่ระบบด้วยบัญชีพนักงานเพื่อบันทึก Daily Report"})]})}}}]);